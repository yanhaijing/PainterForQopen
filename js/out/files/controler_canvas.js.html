<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>controler\canvas.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/painter.controler.Canvas.html">painter.controler.Canvas</a></li>
            
                <li><a href="../classes/painter.controler.Index.html">painter.controler.Index</a></li>
            
                <li><a href="../classes/painter.controler.Nav.html">painter.controler.Nav</a></li>
            
                <li><a href="../classes/painter.controler.Tool.html">painter.controler.Tool</a></li>
            
                <li><a href="../classes/painter.controler.Tool.prototype.html">painter.controler.Tool.prototype</a></li>
            
                <li><a href="../classes/painter.model.CanvasContainerModel.html">painter.model.CanvasContainerModel</a></li>
            
                <li><a href="../classes/painter.model.CanvasModel.html">painter.model.CanvasModel</a></li>
            
                <li><a href="../classes/painter.model.CanvasModel.prototype.html">painter.model.CanvasModel.prototype</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.Cross.html">painter.model.mouseModel.Cross</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.Cross.prototype.html">painter.model.mouseModel.Cross.prototype</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.Eraser.html">painter.model.mouseModel.Eraser</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.Eraser.prototype.html">painter.model.mouseModel.Eraser.prototype</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.EyeDropper.html">painter.model.mouseModel.EyeDropper</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.EyeDropper.prototype.html">painter.model.mouseModel.EyeDropper.prototype</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.FloodFill.html">painter.model.mouseModel.FloodFill</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.FloodFill.prototype.html">painter.model.mouseModel.FloodFill.prototype</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.Mouse.html">painter.model.mouseModel.Mouse</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.Mouse.prototype.html">painter.model.mouseModel.Mouse.prototype</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.Pen.html">painter.model.mouseModel.Pen</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.Pen.prototype.html">painter.model.mouseModel.Pen.prototype</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.Text.html">painter.model.mouseModel.Text</a></li>
            
                <li><a href="../classes/painter.model.mouseModel.Text.prototype.html">painter.model.mouseModel.Text.prototype</a></li>
            
                <li><a href="../classes/painter.model.PointList.html">painter.model.PointList</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Circle.html">painter.model.shapeModel.Circle</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Circle.prototype.html">painter.model.shapeModel.Circle.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.CircleStroke.html">painter.model.shapeModel.CircleStroke</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.CircleStroke.prototype.html">painter.model.shapeModel.CircleStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Cross.html">painter.model.shapeModel.Cross</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Cross.prototype.html">painter.model.shapeModel.Cross.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.CurveClosed.html">painter.model.shapeModel.CurveClosed</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.CurveClosed.prototype.html">painter.model.shapeModel.CurveClosed.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.CurveClosedStroke.html">painter.model.shapeModel.CurveClosedStroke</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.CurveClosedStroke.prototype.html">painter.model.shapeModel.CurveClosedStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Ellipes.html">painter.model.shapeModel.Ellipes</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Ellipes.prototype.html">painter.model.shapeModel.Ellipes.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.EllipesStroke.html">painter.model.shapeModel.EllipesStroke</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.EllipesStroke.prototype.html">painter.model.shapeModel.EllipesStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Eraser.html">painter.model.shapeModel.Eraser</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Eraser.prototype.html">painter.model.shapeModel.Eraser.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.EyeDropper.html">painter.model.shapeModel.EyeDropper</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.EyeDropper.prototype.html">painter.model.shapeModel.EyeDropper.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.FillStroke.html">painter.model.shapeModel.FillStroke</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.FillStroke.prototype.html">painter.model.shapeModel.FillStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.FloodFill.html">painter.model.shapeModel.FloodFill</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.FloodFill.prototype.html">painter.model.shapeModel.FloodFill.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.ImageShape.html">painter.model.shapeModel.ImageShape</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.ImageShape.prototype.html">painter.model.shapeModel.ImageShape.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Line.html">painter.model.shapeModel.Line</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Line.prototype.html">painter.model.shapeModel.Line.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Pen.html">painter.model.shapeModel.Pen</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Pen.prototype.html">painter.model.shapeModel.Pen.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Rect.html">painter.model.shapeModel.Rect</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Rect.prototype.html">painter.model.shapeModel.Rect.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.RectRound.html">painter.model.shapeModel.RectRound</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.RectRound.prototype.html">painter.model.shapeModel.RectRound.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.RectRoundStroke.html">painter.model.shapeModel.RectRoundStroke</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.RectRoundStroke.prototype.html">painter.model.shapeModel.RectRoundStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.RectStroke.html">painter.model.shapeModel.RectStroke</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.RectStroke.prototype.html">painter.model.shapeModel.RectStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Shape.html">painter.model.shapeModel.Shape</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Shape.prototype.html">painter.model.shapeModel.Shape.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Stroke.html">painter.model.shapeModel.Stroke</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Stroke.prototype.html">painter.model.shapeModel.Stroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Text.html">painter.model.shapeModel.Text</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.Text.prototype.html">painter.model.shapeModel.Text.prototype</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.TextStroke.html">painter.model.shapeModel.TextStroke</a></li>
            
                <li><a href="../classes/painter.model.shapeModel.TextStroke.prototype.html">painter.model.shapeModel.TextStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.StorageModel.html">painter.model.StorageModel</a></li>
            
                <li><a href="../classes/painter.model.StorageModel.prototype.html">painter.model.StorageModel.prototype</a></li>
            
                <li><a href="../classes/painter.model.ToolContainerModel.html">painter.model.ToolContainerModel</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Circle.html">painter.model.toolModel.Circle</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Circle.prototype.html">painter.model.toolModel.Circle.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.CircleStroke.html">painter.model.toolModel.CircleStroke</a></li>
            
                <li><a href="../classes/painter.model.toolModel.CircleStroke.prototype.html">painter.model.toolModel.CircleStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Cross.html">painter.model.toolModel.Cross</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Cross.prototype.html">painter.model.toolModel.Cross.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.CurveClosed.html">painter.model.toolModel.CurveClosed</a></li>
            
                <li><a href="../classes/painter.model.toolModel.CurveClosed.prototype.html">painter.model.toolModel.CurveClosed.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.CurveClosedStroke.html">painter.model.toolModel.CurveClosedStroke</a></li>
            
                <li><a href="../classes/painter.model.toolModel.CurveClosedStroke.prototype.html">painter.model.toolModel.CurveClosedStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Ellipes.html">painter.model.toolModel.Ellipes</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Ellipes.prototype.html">painter.model.toolModel.Ellipes.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.EllipesStroke.html">painter.model.toolModel.EllipesStroke</a></li>
            
                <li><a href="../classes/painter.model.toolModel.EllipesStroke.prototype.html">painter.model.toolModel.EllipesStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Eraser.html">painter.model.toolModel.Eraser</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Eraser.prototype.html">painter.model.toolModel.Eraser.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.EyeDropper.html">painter.model.toolModel.EyeDropper</a></li>
            
                <li><a href="../classes/painter.model.toolModel.FloodFill.html">painter.model.toolModel.FloodFill</a></li>
            
                <li><a href="../classes/painter.model.toolModel.FloodFill.prototype.html">painter.model.toolModel.FloodFill.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Line.html">painter.model.toolModel.Line</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Line.prototype.html">painter.model.toolModel.Line.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Pen.html">painter.model.toolModel.Pen</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Pen.prototype.html">painter.model.toolModel.Pen.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Rect.html">painter.model.toolModel.Rect</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Rect.prototype.html">painter.model.toolModel.Rect.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.RectRound.html">painter.model.toolModel.RectRound</a></li>
            
                <li><a href="../classes/painter.model.toolModel.RectRound.prototype.html">painter.model.toolModel.RectRound.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.RectRoundStroke.html">painter.model.toolModel.RectRoundStroke</a></li>
            
                <li><a href="../classes/painter.model.toolModel.RectRoundStroke.prototype.html">painter.model.toolModel.RectRoundStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.RectStroke.html">painter.model.toolModel.RectStroke</a></li>
            
                <li><a href="../classes/painter.model.toolModel.RectStroke.prototype.html">painter.model.toolModel.RectStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Shape.html">painter.model.toolModel.Shape</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Shape.prototype.html">painter.model.toolModel.Shape.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Stroke.html">painter.model.toolModel.Stroke</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Stroke.prototype.html">painter.model.toolModel.Stroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Text.html">painter.model.toolModel.Text</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Text.prototype.html">painter.model.toolModel.Text.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.TextStroke.html">painter.model.toolModel.TextStroke</a></li>
            
                <li><a href="../classes/painter.model.toolModel.TextStroke.prototype.html">painter.model.toolModel.TextStroke.prototype</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Tool.html">painter.model.toolModel.Tool</a></li>
            
                <li><a href="../classes/painter.model.toolModel.Tool.prototype.html">painter.model.toolModel.Tool.prototype</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/canvas.html">canvas</a></li>
            
                <li><a href="../modules/canvasContainerModel.html">canvasContainerModel</a></li>
            
                <li><a href="../modules/canvasModel.html">canvasModel</a></li>
            
                <li><a href="../modules/index.html">index</a></li>
            
                <li><a href="../modules/loading.html">loading</a></li>
            
                <li><a href="../modules/mouse.html">mouse</a></li>
            
                <li><a href="../modules/nav.html">nav</a></li>
            
                <li><a href="../modules/pointListModel.html">pointListModel</a></li>
            
                <li><a href="../modules/shapeModel.html">shapeModel</a></li>
            
                <li><a href="../modules/storageModel.html">storageModel</a></li>
            
                <li><a href="../modules/tool.html">tool</a></li>
            
                <li><a href="../modules/toolContainerModel.html">toolContainerModel</a></li>
            
                <li><a href="../modules/toolModel.html">toolModel</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: controler\canvas.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * 画布控制器
 * @author yan
 * @module canvas
 * @namespace painter.controler
 */

(function($, global){
    &quot;use strict&quot;;
    
    /**
     * 画布类
     * @class Canvas
     * @static
     */
    var Canvas = {
        /**
         * 当前鼠标点击状态
         * @property clickStatus
         * @type Bollean
         * @default false
         */
        clickStatus:false,
        
        /**
         * 鼠标移动点的坐标
         * @property startPoint
         * @type Object
         */
        pointList:Object.create(global.painter.model.PointList),
        
        /**
         * 设置开始点 
         * @method getPointList
         * @return {Object} 坐标点列表对象
         */
        getPointList:function(){
            return this.pointList;
        },
        
        /*
         * 检查鼠标状态
         * @method getClickStatus
         * @return {Bollean} 当前鼠标点击状态
         */
        getClickStatus:function(){
           return this.clickStatus; 
        },
        /**
         * 设置鼠标点击状态
         * @method setClickStatus
         * @param {Bollean} status 是否按下鼠标
         * @return {Bollean} status
         */
        setClickStatus:function(status){
            status = status || false;
            this.clickStatus = status;
            return status; 
        },
        
        /**
         * 初始化
         * @method init
         */
        init:function(){
            var
            
                negativeCanvasDom = $(&#x27;.canvas-negative&#x27;).get(0),
                negativeCanvas = new global.painter.model.CanvasModel(),
                negativeCanvasContainer = Object.create(global.painter.model.CanvasContainerModel),
                
                currentCanvasDom = $(&#x27;.canvas-layer&#x27;).get(0),
                currentCanvas = new global.painter.model.CanvasModel(),
                currentCanvasContainer = Object.create(global.painter.model.CanvasContainerModel),
                
                bufferCanvasDom = $(&#x27;.canvas-buffer&#x27;).get(0),
                bufferCanvas = new global.painter.model.CanvasModel(),
                bufferCanvasContainer = Object.create(global.painter.model.CanvasContainerModel),
                
                mouseCanvasDom = $(&#x27;.canvas-mouse&#x27;).get(0),
                mouseCanvas = new global.painter.model.CanvasModel(),
                mouseCanvasContainer = Object.create(global.painter.model.CanvasContainerModel);
            
            //初始化当前缓冲画布
            negativeCanvas.init(negativeCanvasDom, &quot;negativeCanvas&quot;);
            negativeCanvasContainer.init(negativeCanvas);
            global.painter = global.painter || {};
            global.painter.canvas = global.painter.canvas || {};
            global.painter.canvas.negativeCanvasContainer = negativeCanvasContainer;
                
            //初始化当前画布
            currentCanvas.init(currentCanvasDom, &quot;currentCanvas&quot;);
            currentCanvas.autoSave(60000);//1分钟自动保存一次
            currentCanvasContainer.init(currentCanvas);
            global.painter = global.painter || {};
            global.painter.canvas = global.painter.canvas || {};
            global.painter.canvas.currentCanvasContainer = currentCanvasContainer;
            
            //初始化当前缓冲画布
            bufferCanvas.init(bufferCanvasDom, &quot;bufferCanvas&quot;);
            bufferCanvasContainer.init(bufferCanvas);
            global.painter = global.painter || {};
            global.painter.canvas = global.painter.canvas || {};
            global.painter.canvas.bufferCanvasContainer = bufferCanvasContainer;
            
            //初始化鼠标画布
            mouseCanvas.init(mouseCanvasDom, &quot;mouseCanvas&quot;);
            mouseCanvasContainer.init(mouseCanvas);
            global.painter = global.painter || {};
            global.painter.canvas = global.painter.canvas || {};
            global.painter.canvas.mouseCanvasContainer = mouseCanvasContainer;
            
            this.bindEvent();//版定事件
        },
        
        /**
         * 帮顶事件
         * @method bindEvent
         */
        bindEvent:function(){
            var
                $document = $(document),
                mouseCanvas = global.painter.canvas.mouseCanvasContainer.getCanvas(),
                bufferCanvas = global.painter.canvas.bufferCanvasContainer.getCanvas(),
                currentCanvas = global.painter.canvas.currentCanvasContainer.getCanvas(),
                offsetLeft = mouseCanvas.getLeft(),
                offsetTop = mouseCanvas.getTop(),
                that = this,
                
                //当前的工具
                currentTool = global.painter.tool.currentToolContainer.getTool();
               
            //绑定鼠标画布图层鼠标移动事件
            $document.delegate(&#x27;#canvas-mouse&#x27;, &#x27;mousemove&#x27;, function(e){
                var
                    point = null,
                    pointList = null,
                    index = &quot;&quot;,
                    shape = null,
                    option = null,
                    status = that.getClickStatus(),
                    mouseTool = null,
                    mouse = &#x27;&#x27;,
                    mouseOption = null,
                    mouseShape = null,
                    className = currentTool.getClassName();
                    
                //判断工具是否为图形类
                if(className === &quot;shape&quot;){
                    point = {
                        x:e.pageX - offsetLeft,
                        y:e.pageY - offsetTop
                    };                                
                    mouse = currentTool.getMouse();//获取鼠标名称
                    mouseOption = currentTool.getOption();//获取参数
                    mouseShape = new global.painter.model.mouseModel[mouse]();//创建鼠标对象                            
                    mouseShape.init(mouseOption, point);//初始化鼠标图形
                    //绘制鼠标图形到鼠标层
                    mouseCanvas.clear();
                    mouseCanvas.paint(mouseShape); 
                    
                    
                    //鼠标按下绘制图形操作
                    if(status){     
                        index = currentTool.getName();
                        //添加鼠标坐标
                        pointList = that.getPointList();
                        pointList.add(point);                                                                                               
                        option = currentTool.setPoint(pointList);  
                        
                        shape = new global.painter.model.shapeModel[index]();  
                        shape.init(option); 
                        bufferCanvas.clear();
                        bufferCanvas.paint(shape);  
                    }
                }                                           
            });
            
            //绑定鼠标按下事件
            $document.delegate(&#x27;#canvas-mouse&#x27;, &#x27;mousedown&#x27;, function(e){
                var
                    point = {
                        x:e.pageX - offsetLeft,
                        y:e.pageY - offsetTop
                    },
                    pointList = that.getPointList(),
                    index = &#x27;&#x27;,
                    shape = null,
                    option = null;
                
                that.getPointList().init();//初始化坐标列表    
                that.getPointList().add(point);//添加鼠标坐标
                that.setClickStatus(true);                                
            });
            
            //绑定鼠标弹起事件
            $document.delegate(&#x27;#canvas-mouse&#x27;, &#x27;mouseup&#x27;, function(e){
                var
                    point = {
                        x:e.pageX - offsetLeft,
                        y:e.pageY - offsetTop
                    },
                    pointList = that.getPointList(),
                    index = currentTool.getName(),
                    shape = null,
                    option = null,
                    className = currentTool.getClassName();
                if(className === &quot;shape&quot;){
                    that.getPointList().add(point);//添加鼠标坐标
                    that.setClickStatus(false);//更新鼠标点击状态
                    //绘制图形
                    shape = new global.painter.model.shapeModel[index]()
                    option = currentTool.setPoint(pointList);    
                    shape.init(option); 
                    currentCanvas.paint(shape);
                    
                    bufferCanvas.clear();//清除缓冲画布
                }                    
            });
            
            //绑定鼠标离开
            $document.delegate(&#x27;#canvas-mouse&#x27;, &#x27;mouseleave&#x27;, function(e){
                mouseCanvas.clear();
            });
            
            //绑定鼠标进入
            $document.delegate(&#x27;#canvas-mouse&#x27;, &#x27;mouseenter&#x27;, function(e){
                mouseCanvas.clear();
                //更新当前工具
                currentTool = global.painter.tool.currentToolContainer.getTool();
            });
            
            //绑定鼠标画布图层鼠标移动事件
            document.getElementById(&#x27;canvas-mouse&#x27;).addEventListener(&#x27;touchmove&#x27;, function(e){
                var
                    point = null,
                    pointList = null,
                    index = &quot;&quot;,
                    shape = null,
                    option = null,
                    status = that.getClickStatus(),
                    mouseTool = null,
                    mouse = &#x27;&#x27;,
                    mouseOption = null,
                    mouseShape = null,
                    className = currentTool.getClassName(),
                    touch = e.changedTouches[0];
                
                e.preventDefault();    
                //判断工具是否为图形类
                if(className === &quot;shape&quot;){
                    point = {
                        x:touch.pageX - offsetLeft,
                        y:touch.pageY - offsetTop
                    };                                
                    mouse = currentTool.getMouse();//获取鼠标名称
                    mouseOption = currentTool.getOption();//获取参数
                    mouseShape = new global.painter.model.mouseModel[mouse]();//创建鼠标对象                            
                    mouseShape.init(mouseOption, point);//初始化鼠标图形
                    //绘制鼠标图形到鼠标层
                    mouseCanvas.clear();
                    mouseCanvas.paint(mouseShape); 
                    
                    
                    //鼠标按下绘制图形操作
                    if(status){     
                        index = currentTool.getName();
                        //添加鼠标坐标
                        pointList = that.getPointList();
                        pointList.add(point);                                                                                               
                        option = currentTool.setPoint(pointList);  
                        
                        shape = new global.painter.model.shapeModel[index]();  
                        shape.init(option); 
                        bufferCanvas.clear();
                        bufferCanvas.paint(shape);  
                    }
                }                                           
            }, false);
            
            //绑定鼠标按下事件
            document.getElementById(&#x27;canvas-mouse&#x27;).addEventListener(&#x27;touchstart&#x27;, function(e){
                var
                    touch = e.touches[0],
                    point = {
                        x:touch.pageX - offsetLeft,
                        y:touch.pageY - offsetTop
                    },
                    pointList = that.getPointList(),
                    index = &#x27;&#x27;,
                    shape = null,
                    option = null;
                
                e.preventDefault();
                that.getPointList().init();//初始化坐标列表    
                that.getPointList().add(point);//添加鼠标坐标
                that.setClickStatus(true);                                
            }, false);
            
            //绑定鼠标弹起事件
            document.getElementById(&#x27;canvas-mouse&#x27;).addEventListener(&#x27;touchend&#x27;, function(e){
                var
                    touch = e.changedTouches[0],
                    point = {
                        x:touch.pageX - offsetLeft,
                        y:touch.pageY - offsetTop
                    },
                    pointList = that.getPointList(),
                    index = currentTool.getName(),
                    shape = null,
                    option = null,
                    className = currentTool.getClassName();
                    
                e.preventDefault();
                if(className === &quot;shape&quot;){
                    that.getPointList().add(point);//添加鼠标坐标
                    that.setClickStatus(false);//更新鼠标点击状态
                    //绘制图形
                    shape = new global.painter.model.shapeModel[index]()
                    option = currentTool.setPoint(pointList);    
                    shape.init(option); 
                    currentCanvas.paint(shape);
                    
                    bufferCanvas.clear();//清除缓冲画布
                }                    
            }, false);
        }
    };
    
    $(document).ready(function(){
       Canvas.init(); 
    });
}(jQuery, window));
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
